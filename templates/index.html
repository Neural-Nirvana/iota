<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IoT Control System - Simple</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.8.1/socket.io.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', sans-serif;
            background: #1e1e1e;
            color: white;
            height: 100vh;
        }

        .container {
            display: grid;
            grid-template-columns: 300px 1fr 1fr;
            height: 100vh;
            gap: 10px;
            padding: 10px;
        }

        .sidebar {
            background: #2d2d2d;
            border-radius: 8px;
            padding: 20px;
            overflow-y: auto;
        }

        .main-content {
            background: #2d2d2d;
            border-radius: 8px;
            padding: 20px;
            display: flex;
            flex-direction: column;
        }

        .terminal-panel {
            background: #2d2d2d;
            border-radius: 8px;
            padding: 20px;
            display: flex;
            flex-direction: column;
        }

        .section-title {
            color: #64ffda;
            font-weight: bold;
            margin-bottom: 15px;
            padding-bottom: 5px;
            border-bottom: 1px solid #64ffda;
        }

        .ai-chat {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .chat-messages {
            flex: 1;
            background: #1e1e1e;
            border-radius: 8px;
            padding: 15px;
            overflow-y: auto;
            margin-bottom: 15px;
            min-height: 200px;
        }

        /* Terminal Styles */
        .terminal-container {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .terminal-window {
            flex: 1;
            background: #0c0c0c;
            border-radius: 8px;
            border: 1px solid #444;
            display: flex;
            flex-direction: column;
            font-family: 'Courier New', monospace;
            overflow: hidden;
        }

        .terminal-header {
            background: #333;
            padding: 8px 15px;
            border-bottom: 1px solid #555;
            display: flex;
            align-items: center;
            gap: 8px;
            border-radius: 8px 8px 0 0;
        }

        .terminal-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .terminal-dot.red { background: #ff5f56; }
        .terminal-dot.yellow { background: #ffbd2e; }
        .terminal-dot.green { background: #27ca3f; }

        .terminal-title {
            color: #fff;
            font-size: 12px;
            margin-left: 10px;
        }

        .terminal-output {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
            color: #64ffda;
            font-size: 13px;
            line-height: 1.4;
            background: #0c0c0c;
        }

        .terminal-input-line {
            display: flex;
            align-items: center;
            padding: 10px 15px;
            background: #0c0c0c;
            border-top: 1px solid #333;
        }

        .terminal-prompt {
            color: #64ffda;
            margin-right: 8px;
            font-weight: bold;
        }

        .terminal-input {
            flex: 1;
            background: transparent;
            border: none;
            color: #fff;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            outline: none;
        }

        .terminal-input::placeholder {
            color: #666;
        }

        .terminal-line {
            margin-bottom: 2px;
            word-wrap: break-word;
        }

        .terminal-line.command {
            color: #fff;
        }

        .terminal-line.output {
            color: #64ffda;
        }

        .terminal-line.error {
            color: #ff5722;
        }

        .terminal-line.success {
            color: #4caf50;
        }

        .terminal-line.info {
            color: #2196f3;
        }

        .terminal-line.warning {
            color: #ffab00;
        }

        .terminal-cursor {
            background: #64ffda;
            color: #0c0c0c;
            animation: blink 1s infinite;
        }

        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }

        .terminal-quick-commands {
            margin-bottom: 15px;
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .quick-cmd-btn {
            background: #333;
            border: 1px solid #555;
            color: #64ffda;
            padding: 4px 8px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 11px;
            font-family: 'Courier New', monospace;
            transition: all 0.2s;
        }

        .quick-cmd-btn:hover {
            background: #444;
            border-color: #64ffda;
        }

        .message {
            margin-bottom: 15px;
            padding: 10px;
            border-radius: 8px;
        }

        .message.user {
            background: #0066cc;
            text-align: right;
        }

        .message.ai {
            background: #333;
            border-left: 3px solid #64ffda;
        }

        .ai-input-container {
            display: flex;
            gap: 10px;
        }

        .ai-input {
            flex: 1;
            background: #1e1e1e;
            border: 1px solid #444;
            border-radius: 6px;
            padding: 12px;
            color: white;
            font-size: 16px;
        }

        .ai-input::placeholder {
            color: #888;
        }

        .send-btn {
            background: #64ffda;
            border: none;
            color: #1e1e1e;
            padding: 12px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
        }

        .send-btn:hover {
            background: #4fd3b8;
        }

        .terminal {
            background: #1e1e1e;
            border-radius: 8px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            height: 120px;
            overflow-y: auto;
            border: 1px solid #444;
        }

        .device-list {
            margin-bottom: 20px;
        }

        .device-item {
            background: #1e1e1e;
            border-radius: 6px;
            padding: 10px;
            margin-bottom: 8px;
            border: 1px solid #444;
        }

        .device-port {
            color: #64ffda;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .device-desc {
            font-size: 12px;
            color: #888;
            margin-bottom: 8px;
        }

        .btn {
            background: #64ffda;
            border: none;
            color: #1e1e1e;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            margin-right: 5px;
        }

        .btn:hover {
            background: #4fd3b8;
        }

        .btn.danger {
            background: #ff5722;
            color: white;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
            padding: 10px;
            background: #1e1e1e;
            border-radius: 6px;
        }

        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #ff5722;
        }

        .status-dot.connected {
            background: #4caf50;
        }

        .hidden {
            display: none;
        }

        .error {
            color: #ff5722;
        }

        .success {
            color: #4caf50;
        }

        .warning {
            color: #ffab00;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="status-indicator">
                <div class="status-dot" id="connectionStatus"></div>
                <span id="connectionText">Connecting...</span>
            </div>

            <div class="section-title">üîå Devices</div>
            <button class="btn" onclick="scanDevices()" style="width: 100%; margin-bottom: 15px;">
                Scan Devices
            </button>
            <div id="deviceList" class="device-list"></div>

            <div class="section-title">üìä System</div>
            <div style="background: #1e1e1e; padding: 10px; border-radius: 6px;">
                <div>CPU: <span id="cpuUsage">--</span></div>
                <div>Memory: <span id="memUsage">--</span></div>
            </div>

            <div class="section-title" style="margin-top: 20px;">üìú Activity</div>
            <div class="terminal" id="activityLog">
                <div>üöÄ System started</div>
                <div>Ready for commands...</div>
            </div>
        </div>

        <!-- Main Content - AI Chat -->
        <div class="main-content">
            <div class="section-title">ü§ñ AI Assistant</div>
            
            <div class="ai-chat">
                <div class="chat-messages" id="chatMessages">
                    <div class="message ai">
                        <strong>ü§ñ AI Assistant Ready!</strong><br>
                        I can help you manage IoT devices, execute commands, and more.<br>
                        Try: "scan for devices", "run ls", or "help"
                    </div>
                </div>

                <div class="ai-input-container">
                    <input type="text" class="ai-input" id="aiInput" 
                           placeholder="Type your message here..." 
                           onkeypress="handleKeyPress(event)">
                    <button class="send-btn" onclick="sendMessage()" id="sendBtn">Send</button>
                </div>
            </div>
        </div>

        <!-- Terminal Panel -->
        <div class="terminal-panel">
            <div class="section-title">üíª Interactive Terminal</div>
            
            <div class="terminal-quick-commands">
                <button class="quick-cmd-btn" onclick="runQuickCommand('ls -la')">ls -la</button>
                <button class="quick-cmd-btn" onclick="runQuickCommand('pwd')">pwd</button>
                <button class="quick-cmd-btn" onclick="runQuickCommand('whoami')">whoami</button>
                <button class="quick-cmd-btn" onclick="runQuickCommand('date')">date</button>
                <button class="quick-cmd-btn" onclick="runQuickCommand('uptime')">uptime</button>
                <button class="quick-cmd-btn" onclick="clearTerminal()">clear</button>
            </div>

            <div class="terminal-container">
                <div class="terminal-window">
                    <div class="terminal-header">
                        <div class="terminal-dot red"></div>
                        <div class="terminal-dot yellow"></div>
                        <div class="terminal-dot green"></div>
                        <div class="terminal-title">IoT Terminal</div>
                    </div>
                    
                    <div class="terminal-output" id="terminalOutput">
                        <div class="terminal-line info">üöÄ IoT Control System Terminal</div>
                        <div class="terminal-line info">Type commands below or use AI chat to execute commands</div>
                        <div class="terminal-line info">Example: ls, pwd, echo "hello", whoami</div>
                        <div class="terminal-line">&nbsp;</div>
                    </div>
                    
                    <div class="terminal-input-line">
                        <span class="terminal-prompt">$</span>
                        <input type="text" class="terminal-input" id="terminalInput" 
                               placeholder="Enter command..." 
                               onkeypress="handleTerminalKeyPress(event)"
                               autocomplete="off">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let socket;
        let connectedDevices = {};
        let commandHistory = [];
        let historyIndex = -1;
        let currentCommand = '';

        // Initialize everything when page loads
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ Initializing IoT interface with terminal...');
            
            // Check if all required elements exist
            const requiredElements = ['terminalOutput', 'activityLog', 'chatMessages', 'deviceList'];
            const missingElements = requiredElements.filter(id => !document.getElementById(id));
            
            if (missingElements.length > 0) {
                console.error('Missing required elements:', missingElements);
                alert('Some interface elements are missing. Please refresh the page.');
                return;
            }
            
            initializeSocket();
            scanDevices();
            updateSystemStats();
            focusTerminal();
            
            // Add welcome message to terminal
            setTimeout(() => {
                addTerminalLine('üöÄ Terminal initialized successfully', 'success');
                addActivityLog('System initialized', 'success');
            }, 500);
            
            // Update stats every 10 seconds
            setInterval(updateSystemStats, 10000);
        });

        // Focus terminal input
        function focusTerminal() {
            document.getElementById('terminalInput').focus();
        }

        // Handle terminal keyboard input
        function handleTerminalKeyPress(event) {
            const input = document.getElementById('terminalInput');
            
            if (event.key === 'Enter') {
                const command = input.value.trim();
                if (command) {
                    executeCommand(command);
                    
                    // Add to command history
                    commandHistory.push(command);
                    if (commandHistory.length > 50) {
                        commandHistory.shift(); // Keep only last 50 commands
                    }
                    historyIndex = commandHistory.length;
                    
                    input.value = '';
                }
            } else if (event.key === 'ArrowUp') {
                event.preventDefault();
                if (historyIndex > 0) {
                    historyIndex--;
                    input.value = commandHistory[historyIndex];
                }
            } else if (event.key === 'ArrowDown') {
                event.preventDefault();
                if (historyIndex < commandHistory.length - 1) {
                    historyIndex++;
                    input.value = commandHistory[historyIndex];
                } else {
                    historyIndex = commandHistory.length;
                    input.value = '';
                }
            } else if (event.key === 'Tab') {
                event.preventDefault();
                // Basic tab completion for common commands
                const value = input.value.toLowerCase();
                const completions = ['ls', 'pwd', 'whoami', 'date', 'uptime', 'echo', 'cat', 'mkdir', 'cd'];
                const matches = completions.filter(cmd => cmd.startsWith(value));
                if (matches.length === 1) {
                    input.value = matches[0] + ' ';
                }
            }
        }

        // Execute terminal command
        function executeCommand(command) {
            // Display command in terminal
            addTerminalLine(`$ ${command}`, 'command');
            
            // Send to backend
            if (socket && socket.connected) {
                socket.emit('terminal_command', {
                    command: command,
                    session_id: 'main_terminal'
                });
            } else {
                addTerminalLine('‚ùå Not connected to server', 'error');
            }
            
            // Add to activity log
            addActivityLog(`Command: ${command}`, 'info');
        }

        // Run quick command
        function runQuickCommand(command) {
            document.getElementById('terminalInput').value = command;
            executeCommand(command);
        }

        // Clear terminal
        function clearTerminal() {
            const terminal = document.getElementById('terminalOutput');
            terminal.innerHTML = `
                <div class="terminal-line info">üöÄ Terminal cleared</div>
                <div class="terminal-line">&nbsp;</div>
            `;
        }

        // Add line to terminal output
        function addTerminalLine(text, type = 'output') {
            const terminal = document.getElementById('terminalOutput');
            if (!terminal) {
                console.warn('Terminal output element not found');
                return;
            }
            
            const line = document.createElement('div');
            line.className = `terminal-line ${type}`;
            
            // Handle multi-line output
            if (text.includes('\n')) {
                const lines = text.split('\n');
                lines.forEach((lineText, index) => {
                    if (lineText.trim() || index === 0) {
                        const subLine = document.createElement('div');
                        subLine.className = `terminal-line ${type}`;
                        subLine.textContent = lineText;
                        terminal.appendChild(subLine);
                    }
                });
            } else {
                line.textContent = text;
                terminal.appendChild(line);
            }
            
            // Auto scroll to bottom
            terminal.scrollTop = terminal.scrollHeight;
            
            // Keep only last 1000 lines for performance
            while (terminal.children.length > 1000) {
                terminal.removeChild(terminal.firstChild);
            }
        }

        // Add to activity log
        function addActivityLog(message, type = 'info') {
            const log = document.getElementById('activityLog');
            if (!log) {
                console.warn('Activity log element not found');
                return;
            }
            
            const line = document.createElement('div');
            line.className = type;
            line.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            log.appendChild(line);
            log.scrollTop = log.scrollHeight;
            
            // Keep only last 50 entries
            while (log.children.length > 50) {
                log.removeChild(log.firstChild);
            }
        }

        // Initialize Socket.IO connection
        function initializeSocket() {
            try {
                socket = io();
                console.log('Socket.IO initializing...');

                socket.on('connect', function() {
                    console.log('‚úÖ Connected to server');
                    updateConnectionStatus(true);
                    addTerminalLine('üîó Connected to IoT Control System', 'success');
                    addActivityLog('Connected to server', 'success');
                });

                socket.on('disconnect', function() {
                    console.log('‚ùå Disconnected from server');
                    updateConnectionStatus(false);
                    addTerminalLine('üîó Disconnected from server', 'error');
                    addActivityLog('Disconnected from server', 'error');
                });

                socket.on('ai_response', function(data) {
                    console.log('AI Response received:', data);
                    handleAIResponse(data);
                });

                socket.on('terminal_output', function(data) {
                    console.log('Terminal output:', data);
                    
                    // Show output in terminal
                    if (data.stdout && data.stdout.trim()) {
                        addTerminalLine(data.stdout.trim(), 'output');
                    }
                    if (data.stderr && data.stderr.trim()) {
                        addTerminalLine(data.stderr.trim(), 'error');
                    }
                    
                    // Show in activity log
                    addActivityLog(`Executed: ${data.command}`, data.return_code === 0 ? 'success' : 'error');
                });

                socket.on('device_list_update', function(devices) {
                    console.log('Device list update:', devices);
                    updateDeviceList(devices);
                });

                socket.on('command_executed', function(data) {
                    addTerminalLine(`ü§ñ AI executed: ${data.action}`, 'info');
                    addActivityLog(`AI: ${data.action}`, 'success');
                });

            } catch (error) {
                console.error('Socket initialization error:', error);
                addChatMessage('‚ùå Connection Error: Unable to connect to server', 'ai');
            }
        }

        // Handle keyboard input for AI chat
        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }

        // Send message to AI
        function sendMessage() {
            const input = document.getElementById('aiInput');
            if (!input) {
                console.warn('AI input element not found');
                return;
            }
            
            const message = input.value.trim();
            
            if (!message) return;
            
            console.log('Sending message:', message);
            
            // Add user message to chat
            addChatMessage(message, 'user');
            
            // Clear input
            input.value = '';
            
            // Update button
            const sendBtn = document.getElementById('sendBtn');
            if (sendBtn) {
                sendBtn.textContent = 'Thinking...';
                sendBtn.disabled = true;
            }
            
            // Send to server
            if (socket && socket.connected) {
                socket.emit('natural_language_input', {
                    text: message,
                    context: { timestamp: new Date().toISOString() }
                });
                addActivityLog(`User: ${message}`, 'info');
            } else {
                addChatMessage('‚ùå Not connected to server', 'ai');
                resetSendButton();
            }
        }

        // Handle AI response
        function handleAIResponse(data) {
            console.log('Processing AI response:', data);
            resetSendButton();
            
            let message = '';
            
            if (data.status === 'success') {
                message = `‚úÖ ${data.message || data.interpretation?.command || 'Task completed'}`;
                
                // Handle specific commands
                if (data.interpretation?.command === 'device_scan') {
                    scanDevices();
                }
            } else if (data.status === 'error') {
                message = `‚ùå Error: ${data.message}`;
            } else {
                message = `ü§î ${data.message || "I didn't understand that. Try 'scan devices' or 'help'"}`;
            }
            
            addChatMessage(message, 'ai');
        }

        // Add message to chat
        function addChatMessage(message, sender) {
            const chatMessages = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}`;
            messageDiv.innerHTML = message;
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // Add line to terminal
        function addTerminalLine(text, type = 'info') {
            const terminal = document.getElementById('terminalOutput');
            const line = document.createElement('div');
            line.className = type;
            line.textContent = `[${new Date().toLocaleTimeString()}] ${text}`;
            terminal.appendChild(line);
            terminal.scrollTop = terminal.scrollHeight;
            
            // Keep only last 50 lines
            while (terminal.children.length > 50) {
                terminal.removeChild(terminal.firstChild);
            }
        }

        // Reset send button
        function resetSendButton() {
            const sendBtn = document.getElementById('sendBtn');
            sendBtn.textContent = 'Send';
            sendBtn.disabled = false;
        }

        // Update device list
        function updateDeviceList(devices) {
            const deviceList = document.getElementById('deviceList');
            deviceList.innerHTML = '';
            
            if (!devices || devices.length === 0) {
                deviceList.innerHTML = '<div style="color: #888; font-style: italic;">No devices found</div>';
                return;
            }
            
            devices.forEach(device => {
                const deviceDiv = document.createElement('div');
                deviceDiv.className = 'device-item';
                
                const isConnected = connectedDevices[device.port];
                
                deviceDiv.innerHTML = `
                    <div class="device-port">${device.port}</div>
                    <div class="device-desc">${device.description}</div>
                    <div>
                        <button class="btn ${isConnected ? 'hidden' : ''}" 
                                onclick="connectDevice('${device.port}')">Connect</button>
                        <button class="btn danger ${!isConnected ? 'hidden' : ''}" 
                                onclick="disconnectDevice('${device.port}')">Disconnect</button>
                    </div>
                `;
                
                deviceList.appendChild(deviceDiv);
            });
        }

        // Update connection status
        function updateConnectionStatus(connected) {
            const statusDot = document.getElementById('connectionStatus');
            const statusText = document.getElementById('connectionText');
            
            if (connected) {
                statusDot.classList.add('connected');
                statusText.textContent = 'Connected';
            } else {
                statusDot.classList.remove('connected');
                statusText.textContent = 'Disconnected';
            }
        }

        // Scan for devices
        async function scanDevices() {
            try {
                console.log('Scanning for devices...');
                const response = await fetch('/api/devices/scan');
                const devices = await response.json();
                updateDeviceList(devices);
                addActivityLog(`Found ${devices.length} devices`, 'info');
                if (devices.length > 0) {
                    addTerminalLine(`üîç Found ${devices.length} devices: ${devices.map(d => d.port).join(', ')}`, 'info');
                }
            } catch (error) {
                console.error('Device scan error:', error);
                addTerminalLine(`‚ùå Device scan failed: ${error.message}`, 'error');
                addActivityLog(`Device scan failed: ${error.message}`, 'error');
            }
        }

        // Update device list
        function updateDeviceList(devices) {
            const deviceList = document.getElementById('deviceList');
            deviceList.innerHTML = '';
            
            if (!devices || devices.length === 0) {
                deviceList.innerHTML = '<div style="color: #888; font-style: italic;">No devices found</div>';
                return;
            }
            
            devices.forEach(device => {
                const deviceDiv = document.createElement('div');
                deviceDiv.className = 'device-item';
                
                const isConnected = connectedDevices[device.port];
                
                deviceDiv.innerHTML = `
                    <div class="device-port">${device.port}</div>
                    <div class="device-desc">${device.description}</div>
                    <div>
                        <button class="btn ${isConnected ? 'hidden' : ''}" 
                                onclick="connectDevice('${device.port}')">Connect</button>
                        <button class="btn danger ${!isConnected ? 'hidden' : ''}" 
                                onclick="disconnectDevice('${device.port}')">Disconnect</button>
                    </div>
                `;
                
                deviceList.appendChild(deviceDiv);
            });
        }

        // Connect to device
        async function connectDevice(port) {
            try {
                const response = await fetch('/api/devices/connect', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ port: port })
                });
                
                const result = await response.json();
                if (result.success) {
                    connectedDevices[port] = true;
                    addTerminalLine(`üîå Connected to ${port}`, 'success');
                    addActivityLog(`Connected to ${port}`, 'success');
                    scanDevices(); // Refresh list
                } else {
                    addTerminalLine(`‚ùå Connection to ${port} failed: ${result.message}`, 'error');
                    addActivityLog(`Connection failed: ${result.message}`, 'error');
                }
            } catch (error) {
                addTerminalLine(`‚ùå Connection error: ${error.message}`, 'error');
                addActivityLog(`Connection error: ${error.message}`, 'error');
            }
        }

        // Disconnect from device
        async function disconnectDevice(port) {
            try {
                const response = await fetch('/api/devices/disconnect', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ port: port })
                });
                
                const result = await response.json();
                if (result.success) {
                    delete connectedDevices[port];
                    addTerminalLine(`üîå Disconnected from ${port}`, 'warning');
                    addActivityLog(`Disconnected from ${port}`, 'warning');
                    scanDevices(); // Refresh list
                }
            } catch (error) {
                addTerminalLine(`‚ùå Disconnect error: ${error.message}`, 'error');
                addActivityLog(`Disconnect error: ${error.message}`, 'error');
            }
        }

        // Update system stats
        async function updateSystemStats() {
            try {
                const response = await fetch('/api/system/info');
                const stats = await response.json();
                
                document.getElementById('cpuUsage').textContent = `${stats.cpu_percent}%`;
                document.getElementById('memUsage').textContent = `${stats.memory_percent}%`;
            } catch (error) {
                console.error('Stats update failed:', error);
            }
        }

        // Global debug function
        function debugSystem() {
            console.log('=== System Debug ===');
            console.log('Socket connected:', socket && socket.connected);
            console.log('Connected devices:', connectedDevices);
            console.log('Chat messages:', document.querySelectorAll('.message').length);
            
            // Test message
            addChatMessage('üîß Debug test message', 'user');
            addChatMessage('ü§ñ Debug response - system working!', 'ai');
            addTerminalLine('Debug: System test completed', 'success');
        }

        // Make debug function available in console
        window.debugSystem = debugSystem;

        // Log when everything is ready
        console.log('‚úÖ Simple IoT interface loaded. Try: debugSystem()');
    </script>
</body>
</html>